{% extends 'base.html' %}

{% block content %}
    <div class='message'>
        <h3> Title: {{ title }} </h3>
        <p> Abstract: {{ abstract }} </p>
    </div>

    <div class='message'>
        <h3> Summary </h3>
        <p id='summary'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> PublicationType </h3>
        <div class="vector-container">
            <p class="vector-title" id='ptcategory'>Analyzing ...</p>
            <select id="dropdown-publicationtype">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='ptreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> DataType </h3>
        <div class="vector-container">
            <p class="vector-title" id='dtcategory'>Analyzing ...</p>
            <select id="dropdown-datatype">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='dtreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> Population </h3>
        <div class="vector-container">
            <p class="vector-title" id='popcategory'>Analyzing ...</p>
            <select id="dropdown-population">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='popreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> SubPopulation </h3>
        <div class="vector-container">
            <p class="vector-title" id='subpopcategory'>Analyzing ...</p>
            <select id="dropdown-subpopulation">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='subpopreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> Purpose </h3>
        <div class="vector-container">
            <p class="vector-title" id='purpcategory'>Analyzing ...</p>
            <select id="dropdown-purpose">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='purpreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> RecordingType </h3>
        <div class="vector-container">
            <p class="vector-title" id='rectypecategory'>Analyzing ...</p>
            <select id="dropdown-recordingtype">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='rectypereason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> RecordingTech </h3>
        <div class="vector-container">
            <p class="vector-title" id='rectechcategory'>Analyzing ...</p>
            <select id="dropdown-recordingtech">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='rectechreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> BrainSignal </h3>
        <div class="vector-container">
            <p class="vector-title" id='bscategory'>Analyzing ...</p>
            <select id="dropdown-brainsignal">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='bsreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> Paradigm </h3>
        <div class="vector-container">
            <p class="vector-title" id='pdigmcategory'>Analyzing ...</p>
            <select id="dropdown-paradigm">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='pdigmreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> Application </h3>
        <div class="vector-container">
            <p class="vector-title" id='appcategory'>Analyzing ...</p>
            <select id="dropdown-application">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='appreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> Contribution </h3>
        <div class="vector-container">
            <p class="vector-title" id='ctrbcategory'>Analyzing ...</p>
            <select id="dropdown-contribution">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='ctrbreason'>Analyzing ...</p>
    </div>

    <div class='message'>
        <h3> SubContribution </h3>
        <div class="vector-container">
            <p class="vector-title" id='subctrbcategory'>Analyzing ...</p>
            <select id="dropdown-subcontribution">
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
        </div>
        <p id='subctrbreason'>Analyzing ...</p>
    </div>

    <button type="submit" onclick="upload_results()">Upload Results</button>

    <script>
        function fetch_data(url, category, reason) {
            fetch(url)
            .then(function (response) {
                return response.json();
            }).then(function (jsontext) {
                document.getElementById(category).innerHTML = jsontext['category'];
                document.getElementById(reason).innerHTML = jsontext['reason'];
                //console.log('GET response text:');
                //console.log(text);
            });
        }

        function create_dropdown(id, options, on_change) {
            const list = document.getElementById(id);
            list.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.textContent = option;
                list.appendChild(optionElement);
            });

            // Add change event listener
            list.addEventListener('change', (event) => {
                const selectedValue = event.target.value;
                on_change(selectedValue);
            });
        }

        function update_dropdown_subpopulation(population) {
            options = ['Manual Override'];
            if (population == 'Animal') {
                options = ['Manual Override', 'Cat', 'Fly', 'Frog', 'Mouse', 'Primate', 'Rabbit', 'Rat', 'Sheep'];
            } else if (population == 'Clinical') {
                options = ['Manual Override', 'ALS', 'Brainstem Stroke', 'Cancer', 'Cerebral Palsy', 'Charcot-Marie-Tooth', 'Dystonia', 'Eating Disorders', 'Epilepsy', 'Locked-in (unspecified)', 'MDD', 'Minimally Conscious State', 'Multiple', 'Muscular Dystrophy', 'Paraplegic', 'Persistant Vegetative State', 'Primary Lateral Sclerosis', 'Schizophrenia', 'Severe Motor Deficit', 'Spinal Cord Injury', 'Stroke', 'TBI', 'Tetraplegic', 'Tremor', 'ADHD'];
            } else if (population == 'Healthy') {
                options = ['Manual Override', 'Adults', 'Children', 'College Age', 'Infants', 'Seniors'];
            } else if (population == 'Other') {
                options = ['Manual Override', 'Cell Culture'];
            }
            const list = document.getElementById('dropdown-subpopulation');
            list.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.textContent = option;
                list.appendChild(optionElement);
            });
        }

        function update_dropdown_recordingtech(rectype) {
            options = ['Manual Override'];
            if (rectype == 'Electrical') {
                options = ['Manual Override', 'Electroencephalography (EEG)', 'Electrocorticography (ECoG)', 'Intracortical'];
            } else if (rectype == 'Magnetic') {
                options = ['Manual Override', 'MEG'];
            } else if (rectype == 'Metabolic') {
                options = ['Manual Overide', 'Functional magnetic resonance imaging (fMRI)', 'Ultrasound', 'Functional near infrared spectroscopy (fNIRS)'];
            }
            const list = document.getElementById('dropdown-recordingtech');
            list.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.textContent = option;
                list.appendChild(optionElement);
            });
        }

        function update_dropdown_paradigm(brainsignal) {
            options = ['Manual Override'];
            if (brainsignal == 'Attention') {
                options = ['Manual Override', 'Alpha'];
            } else if (brainsignal == 'Auditory') {
                options = ['Manual Override', 'AEP', 'ASSR', 'P300'];
            } else if (brainsignal == 'Error') {
                options = ['Manual Override', 'ERN', 'FRN'];
            } else if (brainsignal == 'Frontal') {
                options = ['Manual Override', 'Cognitive Tasks'];
            } else if (brainsignal == 'Hybrid') {
                options = ['Manual Override', 'Alpha-SSVEP', 'Imagery Tasks-P300', 'Imagery Tasks-SSVEP', 'P300-SSVEP', 'P300-VEP'];
            } else if (brainsignal == 'Motor') {
                options = ['Manual Override', 'Imagery Tasks', 'Movement'];
            } else if (brainsignal == 'Other') {
                options = ['Manual Override', 'NA_TBD'];
            } else if (brainsignal == 'SCP') {
                options = ['Manual Override', 'Neurofeedback'];
            } else if (brainsignal == 'Visual') {
                options = ['Manual Override', 'mVEP', 'N2pc', 'P300', 'RSVP', 'SSVEP', 'VEP'];
            } else if (brainsignal == 'NA_TBD') {
                options = ['Manual Override', 'NA_TBD'];
            }
            const list = document.getElementById('dropdown-paradigm');
            list.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.textContent = option;
                list.appendChild(optionElement);
            });
        }

        function update_dropdown_subcontribution(contribution) {
            options = ['Manual Override'];
            if (contribution == 'Applied Research') {
                options = ['Manual Override', 'Clinical (assessment)', 'Clinical (therapeutic)', 'Collaborative', 'Healthy Population', 'Home Use', 'Independent Use', 'Other', 'Purpose'];
            } else if (contribution == 'Basic Research') {
                options = ['Manual Override', 'Demographics', 'Ethics', 'Neural Signals', 'Other', 'Signal Measurement or Acquisition', 'Signal Modeling', 'User'];
            } else if (contribution == 'Experimental Development') {
                options = ['Manual Override', 'DSP', 'Feedback or Interface', 'Other', 'Signal Measurement or Acquisition', 'System', 'User'];
            } else if (contribution == 'Support') {
                options = ['Manual Override', 'Education', 'Other', 'Public Dataset', 'Tools or Software'];
            }
            const list = document.getElementById('dropdown-subcontribution');
            list.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.textContent = option;
                list.appendChild(optionElement);
            });
        }

        function update_summary() {
            fetch(`/answer/Summary/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/0`)
            .then(function (response) {
                return response.text();
            }).then(function (text) {
                document.getElementById('summary').innerHTML = text;
                //console.log('GET response text:');
                //console.log(text);
            });
        }

        function update_publicationtype(selected) {
            fetch_data(`/answer/PublicationType/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`, 'ptcategory', 'ptreason');
        }

        function update_datatype(selected) {
            fetch_data(`/answer/DataType/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`, 'dtcategory', 'dtreason');
        }

        function update_subpopulation(population, selected) {
            fetch_data(`/answer/SubPopulation/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/${population}/${selected}`, 'subpopcategory', 'subpopreason');
        }

        function update_population(selected) {
            fetch(`/answer/Population/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`)
            .then(function (response) {
                return response.json();
            }).then(function (jsontext) {
                document.getElementById('popcategory').innerHTML = jsontext['category'];
                document.getElementById('popreason').innerHTML = jsontext['reason'];
                //console.log('GET response text:');
                //console.log(jsontext);
                population = jsontext['category'];
                update_subpopulation(population, 'Manual Override');
                update_dropdown_subpopulation(population);
            });
        }

        function update_purpose(selected) {
            fetch_data(`/answer/Purpose/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`, 'purpcategory', 'purpreason');
        }

        function update_recordingtype(selected) {
            fetch(`/answer/RecordingType/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`)
            .then(function (response) {
                return response.json();
            }).then(function (jsontext) {
                document.getElementById('rectypecategory').innerHTML = jsontext['category'];
                document.getElementById('rectypereason').innerHTML = jsontext['reason'];
                //console.log('GET response text:');
                //console.log(jsontext);
                rectype = jsontext['category'];
                update_recordingtech(rectype, 'Manual Override');
                update_dropdown_recordingtech(rectype);
            });
        }

        function update_recordingtech(rectype, selected) {
            fetch_data(`/answer/RecordingTech/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/${rectype}/${selected}`, 'rectechcategory', 'rectechreason');
        }

        function update_paradigm(brainsignal, selected) {
            fetch_data(`/answer/Paradigm/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/${brainsignal}/${selected}`, 'pdigmcategory', 'pdigmreason');
        }

        function update_brainsignal(selected) {
            fetch(`/answer/BrainSignal/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`)
            .then(function (response) {
                return response.json();
            }).then(function (jsontext) {
                document.getElementById('bscategory').innerHTML = jsontext['category'];
                document.getElementById('bsreason').innerHTML = jsontext['reason'];
                //console.log('GET response text:');
                //console.log(jsontext);
                brainsignal = jsontext['category'];
                update_paradigm(brainsignal, 'Manual Override');
                update_dropdown_paradigm(brainsignal);
            });

        }

        function update_application(selected) {
            fetch_data(`/answer/Application/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`, 'appcategory', 'appreason');
        }

        function update_subcontribution(contribution, selected) {
            fetch_data(`/answer/SubContribution/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/${contribution}/${selected}`, 'subctrbcategory', 'subctrbreason');
        }

        function update_contribution(selected) {
            fetch(`/answer/Contribution/{{model|tojson}}/{{title|tojson}}/{{abstract|tojson}}/{{temperature|tojson}}/0/${selected}`)
            .then(function (response) {
                return response.json();
            }).then(function (jsontext) {
                document.getElementById('ctrbcategory').innerHTML = jsontext['category'];
                document.getElementById('ctrbreason').innerHTML = jsontext['reason'];
                //console.log('GET response text:');
                //console.log(jsontext);
                contribution = jsontext['category'];
                update_subcontribution(contribution, 'Manual Override');
                update_dropdown_subcontribution(contribution);
            });

        }

        const on_change_publicationtype = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_publicationtype(selected);
        };

        const on_change_datatype = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_datatype(selected);
        };

        const on_change_population = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_population(selected);
        };

        const on_change_subpopulation = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            // Note that parentvector is kind of required since we plan to present
            // options to LLM before forcing it to select one of them.
            population = document.getElementById('popcategory').textContent;
            update_subpopulation(population, selected);
        };

        const on_change_purpose = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_purpose(selected);
        };

        const on_change_recordingtype = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_recordingtype(selected);
        };

        const on_change_recordingtech = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            // Note that parentvector is kind of required since we plan to present
            // options to LLM before forcing it to select one of them.
            rectype = document.getElementById('rectypecategory').textContent;
            update_recordingtech(rectype, selected);
        };

        const on_change_brainsignal = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_brainsignal(selected);
        };

        const on_change_paradigm = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            // Note that parentvector is kind of required since we plan to present
            // options to LLM before forcing it to select one of them.
            brainsignal = document.getElementById('bscategory').textContent;
            update_paradigm(brainsignal, selected);
        };

        const on_change_application = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_application(selected);
        };

        const on_change_contribution = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            update_contribution(selected);
        };

        const on_change_subcontribution = (selected) => {
            console.log(`Selected option: ${selected}`);
            // Call your custom function here to handle the selection change
            if (selected == 'Manual Override') {
                return;
            }
            // Note that parentvector is kind of required since we plan to present
            // options to LLM before forcing it to select one of them.
            contribution = document.getElementById('ctrbcategory').textContent;
            update_subcontribution(contribution, selected);
        };

        function create_dropdowns() {
            // TODO take care of NA/TBD
            // PublicationType
            options = ['Manual Override', 'Original Research', 'Review', 'Other', 'NA_TBD'];
            create_dropdown('dropdown-publicationtype', options, on_change_publicationtype);

            // DataType
            options = ['Manual Override', 'Original Data', 'Dataset', 'Other', 'NA_TBD'];
            create_dropdown('dropdown-datatype', options, on_change_datatype);

            // Population
            options = ['Manual Override', 'Animal', 'Clinical', 'Healthy', 'Other', 'NA_TBD'];
            create_dropdown('dropdown-population', options, on_change_population);

            // SubPopulation
            options = ['Manual Override'];
            create_dropdown('dropdown-subpopulation', options, on_change_subpopulation);

            // Purpose
            options = ['Manual Override', 'Replace', 'Enhance', 'Improve', 'Supplement', 'Contribute', 'Design', 'NA_TBD'];
            create_dropdown('dropdown-purpose', options, on_change_purpose);

            // RecordingType
            options = ['Manual Override', 'Electrical', 'Magnetic', 'Metabolic', 'NA_TBD'];
            create_dropdown('dropdown-recordingtype', options, on_change_recordingtype);

            // RecordingTech
            options = ['Manual Override', 'EEG', 'ECoG', 'Intracortical', 'MEG', 'fMRI', 'Ultrasound', 'fNIRS'];
            create_dropdown('dropdown-recordingtech', options, on_change_recordingtech);

            // BrainSignal
            options = ['Manual Override', 'Auditory', 'Error', 'Frontal', 'Hybrid', 'Motor', 'Other', 'SCP', 'Visual', 'NA_TBD'];
            create_dropdown('dropdown-brainsignal', options, on_change_brainsignal);

            // Paradigm
            options = ['Manual Override'];
            create_dropdown('dropdown-paradigm', options, on_change_paradigm);

            // Application
            options = ['Manual Override', 'Brain Switch', 'Clinical or Brain-State Monitoring', 'Communication', 'Cursor or Movement Control', 'Domotics or Environmental Control', 'Gaming or Computer Control', 'Image Triage', 'Neurofeedback', 'Neurprosthetic or Robotics', 'Offline or Online Target Selection', 'Other', 'NA_TBD'];
            create_dropdown('dropdown-application', options, on_change_application);

            // Contribution
            options = ['Manual Override', 'Applied Research', 'Basic Research', 'Experimental Development', 'Support'];
            create_dropdown('dropdown-contribution', options, on_change_contribution);

            // SubContribution
            options = ['Manual Override'];
            create_dropdown('dropdown-subcontribution', options, on_change_subcontribution);
        }

        function upload_results() {
            fetch(`/upload/`)
            .then(function (response) {
                return response.text();
            }).then(function (text) {
                //console.log('GET response text:');
                //console.log(text);
            });
            window.location.href = '/classify/';
        }

        create_dropdowns();

        update_summary();
        update_publicationtype('Manual Override');
        update_datatype('Manual Override');
        update_population('Manual Override');
        update_purpose('Manual Override');
        update_recordingtype('Manual Override');
        update_brainsignal('Manual Override');
        update_application('Manual Override');
        update_contribution('Manual Override');

    </script>
{% endblock %}
